{
  "my-amazing-team:sales/MyCustomTieredSales": {
    "fqn": "my-amazing-team:sales/MyCustomTieredSales",
    "version": "0.0.1",
    "address": {
      "5": "0xF150600F6851C020c3d7c0aB2E1ba1150Fc49106",
      "goerli": "0xF150600F6851C020c3d7c0aB2E1ba1150Fc49106"
    },
    "artifact": {
      "_format": "hh-sol-artifact-1",
      "contractName": "MyCustomTieredSales",
      "sourceName": "src/sales/MyCustomTieredSales.sol",
      "abi": [
        {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "internalType": "address",
              "name": "previousOwner",
              "type": "address"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "newOwner",
              "type": "address"
            }
          ],
          "name": "OwnershipTransferred",
          "type": "event"
        },
        {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "internalType": "bytes32",
              "name": "role",
              "type": "bytes32"
            },
            {
              "indexed": true,
              "internalType": "bytes32",
              "name": "previousAdminRole",
              "type": "bytes32"
            },
            {
              "indexed": true,
              "internalType": "bytes32",
              "name": "newAdminRole",
              "type": "bytes32"
            }
          ],
          "name": "RoleAdminChanged",
          "type": "event"
        },
        {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "internalType": "bytes32",
              "name": "role",
              "type": "bytes32"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "account",
              "type": "address"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "sender",
              "type": "address"
            }
          ],
          "name": "RoleGranted",
          "type": "event"
        },
        {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "internalType": "bytes32",
              "name": "role",
              "type": "bytes32"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "account",
              "type": "address"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "sender",
              "type": "address"
            }
          ],
          "name": "RoleRevoked",
          "type": "event"
        },
        {
          "anonymous": false,
          "inputs": [
            {
              "indexed": true,
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "operator",
              "type": "address"
            },
            {
              "indexed": true,
              "internalType": "address",
              "name": "minter",
              "type": "address"
            },
            {
              "indexed": false,
              "internalType": "uint256",
              "name": "count",
              "type": "uint256"
            }
          ],
          "name": "TierSale",
          "type": "event"
        },
        {
          "inputs": [],
          "name": "DEFAULT_ADMIN_ROLE",
          "outputs": [
            {
              "internalType": "bytes32",
              "name": "",
              "type": "bytes32"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "MERCHANT_ROLE",
          "outputs": [
            {
              "internalType": "bytes32",
              "name": "",
              "type": "bytes32"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            },
            {
              "internalType": "address",
              "name": "minter",
              "type": "address"
            },
            {
              "internalType": "uint256",
              "name": "maxAllowance",
              "type": "uint256"
            },
            {
              "internalType": "bytes32[]",
              "name": "proof",
              "type": "bytes32[]"
            }
          ],
          "name": "eligibleForTier",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "maxMintable",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "count",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "maxAllowance",
              "type": "uint256"
            },
            {
              "internalType": "bytes32[]",
              "name": "proof",
              "type": "bytes32[]"
            }
          ],
          "name": "mintByTier",
          "outputs": [],
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "address",
              "name": "minter",
              "type": "address"
            },
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "count",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "maxAllowance",
              "type": "uint256"
            },
            {
              "internalType": "bytes32[]",
              "name": "proof",
              "type": "bytes32[]"
            }
          ],
          "name": "mintByTierByRole",
          "outputs": [],
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            },
            {
              "internalType": "address",
              "name": "minter",
              "type": "address"
            },
            {
              "internalType": "uint256",
              "name": "maxAllowance",
              "type": "uint256"
            },
            {
              "internalType": "bytes32[]",
              "name": "proof",
              "type": "bytes32[]"
            }
          ],
          "name": "onTierAllowlist",
          "outputs": [
            {
              "internalType": "bool",
              "name": "",
              "type": "bool"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            }
          ],
          "name": "remainingForTier",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "reservedMints",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "address",
              "name": "erc721ContractAddress",
              "type": "address"
            },
            {
              "internalType": "address",
              "name": "erc1155ContractAddress",
              "type": "address"
            }
          ],
          "name": "setTargetTokens",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            }
          ],
          "name": "tierMints",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            }
          ],
          "name": "tiers",
          "outputs": [
            {
              "components": [
                {
                  "internalType": "uint256",
                  "name": "start",
                  "type": "uint256"
                },
                {
                  "internalType": "uint256",
                  "name": "end",
                  "type": "uint256"
                },
                {
                  "internalType": "address",
                  "name": "currency",
                  "type": "address"
                },
                {
                  "internalType": "uint256",
                  "name": "price",
                  "type": "uint256"
                },
                {
                  "internalType": "uint256",
                  "name": "maxPerWallet",
                  "type": "uint256"
                },
                {
                  "internalType": "bytes32",
                  "name": "merkleRoot",
                  "type": "bytes32"
                },
                {
                  "internalType": "uint256",
                  "name": "reserved",
                  "type": "uint256"
                },
                {
                  "internalType": "uint256",
                  "name": "maxAllocation",
                  "type": "uint256"
                }
              ],
              "internalType": "struct ITieredSalesInternal.Tier",
              "name": "",
              "type": "tuple"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "totalReserved",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "tierId",
              "type": "uint256"
            },
            {
              "internalType": "address",
              "name": "wallet",
              "type": "address"
            }
          ],
          "name": "walletMintedByTier",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        }
      ],
      "bytecode": "0x608060405234801561001057600080fd5b506001600055611c2d806100256000396000f3fe6080604052600436106100d25760003560e01c80635897f8781161007f578063a217fddf11610059578063a217fddf146102f2578063b3d3583914610307578063bd2c18f71461033b578063c71b0e1c1461035b57600080fd5b80635897f8781461028f5780635ea2c91b146102af57806368c7d37c146102c257600080fd5b80632cb9b2ac116100b05780632cb9b2ac146101fc578063352a90bb1461023057806353367f081461024357600080fd5b8063039af9eb146100d75780630af7a5101461016a5780631123f2ef1461018c575b600080fd5b3480156100e357600080fd5b506100f76100f236600461183d565b61038f565b604051610161919060006101008201905082518252602083015160208301526001600160a01b036040840151166040830152606083015160608301526080830151608083015260a083015160a083015260c083015160c083015260e083015160e083015292915050565b60405180910390f35b34801561017657600080fd5b5061018a610185366004611872565b610479565b005b34801561019857600080fd5b506101ee6101a73660046118a5565b60009182527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbf602090815260408084206001600160a01b0393909316845291905290205490565b604051908152602001610161565b34801561020857600080fd5b507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbc546101ee565b61018a61023e366004611914565b61058b565b34801561024f57600080fd5b506101ee61025e36600461183d565b60009081527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbe602052604090205490565b34801561029b57600080fd5b506101ee6102aa36600461183d565b6107a3565b61018a6102bd366004611985565b61081a565b3480156102ce57600080fd5b506102e26102dd3660046119e6565b610a05565b6040519015158152602001610161565b3480156102fe57600080fd5b506101ee600081565b34801561031357600080fd5b506101ee7f3c4a2d89ed8b4cf4347fec87df1c38410f8fc538bf9fd64c10f2717bc0feff3681565b34801561034757600080fd5b506101ee6103563660046119e6565b610a1e565b34801561036757600080fd5b507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb546101ee565b6103e3604051806101000160405280600081526020016000815260200160006001600160a01b0316815260200160008152602001600081526020016000801916815260200160008152602001600081525090565b5060009081527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbd60209081526040918290208251610100810184528154815260018201549281019290925260028101546001600160a01b0316928201929092526003820154606082015260048201546080820152600582015460a0820152600682015460c082015260079091015460e082015290565b7fc0ea367cb0174dd5521cd2372c76f8c13e6c1f832c71f1d6e0cbc185c9cc8ed4546001600160a01b03166104ac610a51565b6001600160a01b0316146105075760405162461bcd60e51b815260206004820152601d60248201527f4f776e61626c653a2073656e646572206d757374206265206f776e657200000060448201526064015b60405180910390fd5b7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde64780546001600160a01b039384167fffffffffffffffffffffffff0000000000000000000000000000000000000000918216179091557f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde6488054929093169116179055565b6002600054036105dd5760405162461bcd60e51b815260206004820152601f60248201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c0060448201526064016104fe565b60026000557f3c4a2d89ed8b4cf4347fec87df1c38410f8fc538bf9fd64c10f2717bc0feff3661060c81610a60565b61061a878787878787610a74565b7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde647546001600160a01b0316631a056e71610652610a51565b6040516001600160e01b031960e084901b1681526001600160a01b03909116600482015260248101889052604401600060405180830381600087803b15801561069a57600080fd5b505af11580156106ae573d6000803e3d6000fd5b505050506106d97f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde64790565b600101546001600160a01b03166372642f566106f3610a51565b7f46f908971db3fbea57e8a21b2e54575e0e567ff2f950ead3c0dc83f15ec6715460008a815260209190915260408082205490516001600160e01b031960e086901b1681526001600160a01b03909316600484015260248301526044820189905260806064830152608482015260a401600060405180830381600087803b15801561077d57600080fd5b505af1158015610791573d6000803e3d6000fd5b50506001600055505050505050505050565b60007fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb816107d084610cb8565b60008581526003840160209081526040808320546002870190925282206007015492935090916108009190611a47565b90508082101561081257509392505050565b949350505050565b60026000540361086c5760405162461bcd60e51b815260206004820152601f60248201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c0060448201526064016104fe565b600260005561087e8585858585610d70565b7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde647546001600160a01b0316631a056e716108b6610a51565b6040516001600160e01b031960e084901b1681526001600160a01b03909116600482015260248101879052604401600060405180830381600087803b1580156108fe57600080fd5b505af1158015610912573d6000803e3d6000fd5b5050505061093d7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde64790565b600101546001600160a01b03166372642f56610957610a51565b7f46f908971db3fbea57e8a21b2e54575e0e567ff2f950ead3c0dc83f15ec67154600089815260209190915260408082205490516001600160e01b031960e086901b1681526001600160a01b03909316600484015260248301526044820188905260806064830152608482015260a401600060405180830381600087803b1580156109e157600080fd5b505af11580156109f5573d6000803e3d6000fd5b5050600160005550505050505050565b6000610a1486868686866110f3565b9695505050505050565b6000610a1486868686866111af565b7fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb90565b6000610a5b611481565b905090565b610a7181610a6c610a51565b6114c7565b50565b6000610a8386888686866111af565b90507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb81861115610af65760405162461bcd60e51b815260206004820152600b60248201527f455843454544535f4d415800000000000000000000000000000000000000000060448201526064016104fe565b610aff87610cb8565b861115610b4e5760405162461bcd60e51b815260206004820152600e60248201527f455843454544535f535550504c5900000000000000000000000000000000000060448201526064016104fe565b60008781526002820160209081526040808320600701546003850190925290912054610b7a9088611a5e565b1115610bc85760405162461bcd60e51b815260206004820152601260248201527f455843454544535f414c4c4f434154494f4e000000000000000000000000000060448201526064016104fe565b600087815260048201602090815260408083206001600160a01b038c16845290915281208054889290610bfc908490611a5e565b9091555050600087815260038201602052604081208054889290610c21908490611a5e565b9091555050600087815260028201602052604090206006015415610c595785816001016000828254610c539190611a5e565b90915550505b876001600160a01b0316610c6b610a51565b6001600160a01b0316887f6b995c2a6f13fda3bb1769289588283f7687b909bdceba7789276ad33ad422f789604051610ca691815260200190565b60405180910390a45050505050505050565b7fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbc547fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb8054600092610d0991611a47565b610d1590600019611a47565b600084815260028301602052604090206006015490925015610d6a5760008381526003820160209081526040808320546002850190925290912060060154610d5d9190611a47565b610d679083611a5e565b91505b50919050565b6000610d7a610a51565b90506000610d8b87838787876111af565b90507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb81871115610dfe5760405162461bcd60e51b815260206004820152600b60248201527f455843454544535f4d415800000000000000000000000000000000000000000060448201526064016104fe565b610e0788610cb8565b871115610e565760405162461bcd60e51b815260206004820152600e60248201527f455843454544535f535550504c5900000000000000000000000000000000000060448201526064016104fe565b60008881526002820160209081526040808320600701546003850190925290912054610e829089611a5e565b1115610ed05760405162461bcd60e51b815260206004820152601260248201527f455843454544535f414c4c4f434154494f4e000000000000000000000000000060448201526064016104fe565b60008881526002808301602052604090912001546001600160a01b0316610f655760008881526002820160205260409020600301543490610f12908990611a76565b1115610f605760405162461bcd60e51b815260206004820152601360248201527f494e53554646494349454e545f414d4f554e540000000000000000000000000060448201526064016104fe565b61101c565b600088815260028083016020526040909120908101546003909101546001600160a01b03909116906323b872dd9085903090610fa2908c90611a76565b6040516001600160e01b031960e086901b1681526001600160a01b03938416600482015292909116602483015260448201526064016020604051808303816000875af1158015610ff6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061101a9190611a95565b505b600088815260048201602090815260408083206001600160a01b038716845290915281208054899290611050908490611a5e565b9091555050600088815260038201602052604081208054899290611075908490611a5e565b90915550506000888152600282016020526040902060060154156110ad57868160010160008282546110a79190611a5e565b90915550505b826001600160a01b0316836001600160a01b0316897f6b995c2a6f13fda3bb1769289588283f7687b909bdceba7789276ad33ad422f78a604051610ca691815260200190565b6000610a148383808060200260200160405190810160405280939291908181526020018383602002808284376000920191909152506111359250610a2d915050565b600089815260029190910160205260409020600501546111aa88886040517fffffffffffffffffffffffffffffffffffffffff000000000000000000000000606084901b1660208201526034810182905260009060540160405160208183030381529060405280519060200120905092915050565b61155f565b60008581527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbd60205260408120600401547fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb9061124e5760405162461bcd60e51b815260206004820152600a60248201527f4e4f545f4558495354530000000000000000000000000000000000000000000060448201526064016104fe565b60008781526002820160205260409020544210156112ae5760405162461bcd60e51b815260206004820152600b60248201527f4e4f545f5354415254454400000000000000000000000000000000000000000060448201526064016104fe565b60008781526002820160205260409020600101544211156113115760405162461bcd60e51b815260206004820152600d60248201527f414c52454144595f454e4445440000000000000000000000000000000000000060448201526064016104fe565b60008781526004808301602090815260408084206001600160a01b038b1685528252808420548b85526002860190925290922001546113509190611a47565b60008881526002830160205260409020600501549092501561147757600087815260048201602090815260408083206001600160a01b038a16845290915290205485116113df5760405162461bcd60e51b815260206004820152600f60248201527f4d415845445f414c4c4f57414e4345000000000000000000000000000000000060448201526064016104fe565b6113ec87878787876110f3565b6114385760405162461bcd60e51b815260206004820152600f60248201527f4e4f545f414c4c4f574c4953544544000000000000000000000000000000000060448201526064016104fe565b600087815260048201602090815260408083206001600160a01b038a1684529091528120546114679087611a47565b905080831115611475578092505b505b5095945050505050565b7fdb1d5e345c4903e9a32b6674ecc8b1deaddbbb2551474fb34c9d34becbe7f420546000906001600160a01b031633036114c2575060131936013560601c90565b503390565b60008281527f2e59e4c2e927cdddbb64e181e0668d9a0fa70dd88f94d999cd87d5496a20da62602090815260408083206001600160a01b038516845290915290205460ff1661155b5761151981611575565b611524836020611591565b604051602001611535929190611ae7565b60408051601f198184030181529082905262461bcd60e51b82526104fe91600401611b68565b5050565b60008261156c85846117c1565b14949350505050565b606061158b6001600160a01b0383166014611591565b92915050565b606060006115a0836002611a76565b6115ab906002611a5e565b67ffffffffffffffff8111156115c3576115c3611b9b565b6040519080825280601f01601f1916602001820160405280156115ed576020820181803683370190505b5090507f30000000000000000000000000000000000000000000000000000000000000008160008151811061162457611624611bb1565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053507f78000000000000000000000000000000000000000000000000000000000000008160018151811061168757611687611bb1565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060006116c3846002611a76565b6116ce906001611a5e565b90505b600181111561176b577f303132333435363738396162636465660000000000000000000000000000000085600f166010811061170f5761170f611bb1565b1a60f81b82828151811061172557611725611bb1565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060049490941c9361176481611bc7565b90506116d1565b5083156117ba5760405162461bcd60e51b815260206004820181905260248201527f537472696e67733a20686578206c656e67746820696e73756666696369656e7460448201526064016104fe565b9392505050565b600081815b8451811015611806576117f2828683815181106117e5576117e5611bb1565b602002602001015161180e565b9150806117fe81611bde565b9150506117c6565b509392505050565b600081831061182a5760008281526020849052604090206117ba565b60008381526020839052604090206117ba565b60006020828403121561184f57600080fd5b5035919050565b80356001600160a01b038116811461186d57600080fd5b919050565b6000806040838503121561188557600080fd5b61188e83611856565b915061189c60208401611856565b90509250929050565b600080604083850312156118b857600080fd5b8235915061189c60208401611856565b60008083601f8401126118da57600080fd5b50813567ffffffffffffffff8111156118f257600080fd5b6020830191508360208260051b850101111561190d57600080fd5b9250929050565b60008060008060008060a0878903121561192d57600080fd5b61193687611856565b9550602087013594506040870135935060608701359250608087013567ffffffffffffffff81111561196757600080fd5b61197389828a016118c8565b979a9699509497509295939492505050565b60008060008060006080868803121561199d57600080fd5b853594506020860135935060408601359250606086013567ffffffffffffffff8111156119c957600080fd5b6119d5888289016118c8565b969995985093965092949392505050565b6000806000806000608086880312156119fe57600080fd5b85359450611a0e60208701611856565b935060408601359250606086013567ffffffffffffffff8111156119c957600080fd5b634e487b7160e01b600052601160045260246000fd5b600082821015611a5957611a59611a31565b500390565b60008219821115611a7157611a71611a31565b500190565b6000816000190483118215151615611a9057611a90611a31565b500290565b600060208284031215611aa757600080fd5b815180151581146117ba57600080fd5b60005b83811015611ad2578181015183820152602001611aba565b83811115611ae1576000848401525b50505050565b7f416363657373436f6e74726f6c3a206163636f756e7420000000000000000000815260008351611b1f816017850160208801611ab7565b7f206973206d697373696e6720726f6c65200000000000000000000000000000006017918401918201528351611b5c816028840160208801611ab7565b01602801949350505050565b6020815260008251806020840152611b87816040850160208701611ab7565b601f01601f19169190910160400192915050565b634e487b7160e01b600052604160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b600081611bd657611bd6611a31565b506000190190565b600060018201611bf057611bf0611a31565b506001019056fea264697066735822122042274050735f9c21d3ae4bb3ff67199f77d98ed3e89a8f728d38d9dd41db247364736f6c634300080f0033",
      "deployedBytecode": "0x6080604052600436106100d25760003560e01c80635897f8781161007f578063a217fddf11610059578063a217fddf146102f2578063b3d3583914610307578063bd2c18f71461033b578063c71b0e1c1461035b57600080fd5b80635897f8781461028f5780635ea2c91b146102af57806368c7d37c146102c257600080fd5b80632cb9b2ac116100b05780632cb9b2ac146101fc578063352a90bb1461023057806353367f081461024357600080fd5b8063039af9eb146100d75780630af7a5101461016a5780631123f2ef1461018c575b600080fd5b3480156100e357600080fd5b506100f76100f236600461183d565b61038f565b604051610161919060006101008201905082518252602083015160208301526001600160a01b036040840151166040830152606083015160608301526080830151608083015260a083015160a083015260c083015160c083015260e083015160e083015292915050565b60405180910390f35b34801561017657600080fd5b5061018a610185366004611872565b610479565b005b34801561019857600080fd5b506101ee6101a73660046118a5565b60009182527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbf602090815260408084206001600160a01b0393909316845291905290205490565b604051908152602001610161565b34801561020857600080fd5b507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbc546101ee565b61018a61023e366004611914565b61058b565b34801561024f57600080fd5b506101ee61025e36600461183d565b60009081527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbe602052604090205490565b34801561029b57600080fd5b506101ee6102aa36600461183d565b6107a3565b61018a6102bd366004611985565b61081a565b3480156102ce57600080fd5b506102e26102dd3660046119e6565b610a05565b6040519015158152602001610161565b3480156102fe57600080fd5b506101ee600081565b34801561031357600080fd5b506101ee7f3c4a2d89ed8b4cf4347fec87df1c38410f8fc538bf9fd64c10f2717bc0feff3681565b34801561034757600080fd5b506101ee6103563660046119e6565b610a1e565b34801561036757600080fd5b507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb546101ee565b6103e3604051806101000160405280600081526020016000815260200160006001600160a01b0316815260200160008152602001600081526020016000801916815260200160008152602001600081525090565b5060009081527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbd60209081526040918290208251610100810184528154815260018201549281019290925260028101546001600160a01b0316928201929092526003820154606082015260048201546080820152600582015460a0820152600682015460c082015260079091015460e082015290565b7fc0ea367cb0174dd5521cd2372c76f8c13e6c1f832c71f1d6e0cbc185c9cc8ed4546001600160a01b03166104ac610a51565b6001600160a01b0316146105075760405162461bcd60e51b815260206004820152601d60248201527f4f776e61626c653a2073656e646572206d757374206265206f776e657200000060448201526064015b60405180910390fd5b7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde64780546001600160a01b039384167fffffffffffffffffffffffff0000000000000000000000000000000000000000918216179091557f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde6488054929093169116179055565b6002600054036105dd5760405162461bcd60e51b815260206004820152601f60248201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c0060448201526064016104fe565b60026000557f3c4a2d89ed8b4cf4347fec87df1c38410f8fc538bf9fd64c10f2717bc0feff3661060c81610a60565b61061a878787878787610a74565b7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde647546001600160a01b0316631a056e71610652610a51565b6040516001600160e01b031960e084901b1681526001600160a01b03909116600482015260248101889052604401600060405180830381600087803b15801561069a57600080fd5b505af11580156106ae573d6000803e3d6000fd5b505050506106d97f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde64790565b600101546001600160a01b03166372642f566106f3610a51565b7f46f908971db3fbea57e8a21b2e54575e0e567ff2f950ead3c0dc83f15ec6715460008a815260209190915260408082205490516001600160e01b031960e086901b1681526001600160a01b03909316600484015260248301526044820189905260806064830152608482015260a401600060405180830381600087803b15801561077d57600080fd5b505af1158015610791573d6000803e3d6000fd5b50506001600055505050505050505050565b60007fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb816107d084610cb8565b60008581526003840160209081526040808320546002870190925282206007015492935090916108009190611a47565b90508082101561081257509392505050565b949350505050565b60026000540361086c5760405162461bcd60e51b815260206004820152601f60248201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c0060448201526064016104fe565b600260005561087e8585858585610d70565b7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde647546001600160a01b0316631a056e716108b6610a51565b6040516001600160e01b031960e084901b1681526001600160a01b03909116600482015260248101879052604401600060405180830381600087803b1580156108fe57600080fd5b505af1158015610912573d6000803e3d6000fd5b5050505061093d7f29076d6fec33d3367960b20e90f32c6706ebfb45150130b825182449f8dde64790565b600101546001600160a01b03166372642f56610957610a51565b7f46f908971db3fbea57e8a21b2e54575e0e567ff2f950ead3c0dc83f15ec67154600089815260209190915260408082205490516001600160e01b031960e086901b1681526001600160a01b03909316600484015260248301526044820188905260806064830152608482015260a401600060405180830381600087803b1580156109e157600080fd5b505af11580156109f5573d6000803e3d6000fd5b5050600160005550505050505050565b6000610a1486868686866110f3565b9695505050505050565b6000610a1486868686866111af565b7fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb90565b6000610a5b611481565b905090565b610a7181610a6c610a51565b6114c7565b50565b6000610a8386888686866111af565b90507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb81861115610af65760405162461bcd60e51b815260206004820152600b60248201527f455843454544535f4d415800000000000000000000000000000000000000000060448201526064016104fe565b610aff87610cb8565b861115610b4e5760405162461bcd60e51b815260206004820152600e60248201527f455843454544535f535550504c5900000000000000000000000000000000000060448201526064016104fe565b60008781526002820160209081526040808320600701546003850190925290912054610b7a9088611a5e565b1115610bc85760405162461bcd60e51b815260206004820152601260248201527f455843454544535f414c4c4f434154494f4e000000000000000000000000000060448201526064016104fe565b600087815260048201602090815260408083206001600160a01b038c16845290915281208054889290610bfc908490611a5e565b9091555050600087815260038201602052604081208054889290610c21908490611a5e565b9091555050600087815260028201602052604090206006015415610c595785816001016000828254610c539190611a5e565b90915550505b876001600160a01b0316610c6b610a51565b6001600160a01b0316887f6b995c2a6f13fda3bb1769289588283f7687b909bdceba7789276ad33ad422f789604051610ca691815260200190565b60405180910390a45050505050505050565b7fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbc547fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb8054600092610d0991611a47565b610d1590600019611a47565b600084815260028301602052604090206006015490925015610d6a5760008381526003820160209081526040808320546002850190925290912060060154610d5d9190611a47565b610d679083611a5e565b91505b50919050565b6000610d7a610a51565b90506000610d8b87838787876111af565b90507fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb81871115610dfe5760405162461bcd60e51b815260206004820152600b60248201527f455843454544535f4d415800000000000000000000000000000000000000000060448201526064016104fe565b610e0788610cb8565b871115610e565760405162461bcd60e51b815260206004820152600e60248201527f455843454544535f535550504c5900000000000000000000000000000000000060448201526064016104fe565b60008881526002820160209081526040808320600701546003850190925290912054610e829089611a5e565b1115610ed05760405162461bcd60e51b815260206004820152601260248201527f455843454544535f414c4c4f434154494f4e000000000000000000000000000060448201526064016104fe565b60008881526002808301602052604090912001546001600160a01b0316610f655760008881526002820160205260409020600301543490610f12908990611a76565b1115610f605760405162461bcd60e51b815260206004820152601360248201527f494e53554646494349454e545f414d4f554e540000000000000000000000000060448201526064016104fe565b61101c565b600088815260028083016020526040909120908101546003909101546001600160a01b03909116906323b872dd9085903090610fa2908c90611a76565b6040516001600160e01b031960e086901b1681526001600160a01b03938416600482015292909116602483015260448201526064016020604051808303816000875af1158015610ff6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061101a9190611a95565b505b600088815260048201602090815260408083206001600160a01b038716845290915281208054899290611050908490611a5e565b9091555050600088815260038201602052604081208054899290611075908490611a5e565b90915550506000888152600282016020526040902060060154156110ad57868160010160008282546110a79190611a5e565b90915550505b826001600160a01b0316836001600160a01b0316897f6b995c2a6f13fda3bb1769289588283f7687b909bdceba7789276ad33ad422f78a604051610ca691815260200190565b6000610a148383808060200260200160405190810160405280939291908181526020018383602002808284376000920191909152506111359250610a2d915050565b600089815260029190910160205260409020600501546111aa88886040517fffffffffffffffffffffffffffffffffffffffff000000000000000000000000606084901b1660208201526034810182905260009060540160405160208183030381529060405280519060200120905092915050565b61155f565b60008581527fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbd60205260408120600401547fb7471df0c7246ed3d4a380504edfbb03f5845b709c7716243791636e4ba46cbb9061124e5760405162461bcd60e51b815260206004820152600a60248201527f4e4f545f4558495354530000000000000000000000000000000000000000000060448201526064016104fe565b60008781526002820160205260409020544210156112ae5760405162461bcd60e51b815260206004820152600b60248201527f4e4f545f5354415254454400000000000000000000000000000000000000000060448201526064016104fe565b60008781526002820160205260409020600101544211156113115760405162461bcd60e51b815260206004820152600d60248201527f414c52454144595f454e4445440000000000000000000000000000000000000060448201526064016104fe565b60008781526004808301602090815260408084206001600160a01b038b1685528252808420548b85526002860190925290922001546113509190611a47565b60008881526002830160205260409020600501549092501561147757600087815260048201602090815260408083206001600160a01b038a16845290915290205485116113df5760405162461bcd60e51b815260206004820152600f60248201527f4d415845445f414c4c4f57414e4345000000000000000000000000000000000060448201526064016104fe565b6113ec87878787876110f3565b6114385760405162461bcd60e51b815260206004820152600f60248201527f4e4f545f414c4c4f574c4953544544000000000000000000000000000000000060448201526064016104fe565b600087815260048201602090815260408083206001600160a01b038a1684529091528120546114679087611a47565b905080831115611475578092505b505b5095945050505050565b7fdb1d5e345c4903e9a32b6674ecc8b1deaddbbb2551474fb34c9d34becbe7f420546000906001600160a01b031633036114c2575060131936013560601c90565b503390565b60008281527f2e59e4c2e927cdddbb64e181e0668d9a0fa70dd88f94d999cd87d5496a20da62602090815260408083206001600160a01b038516845290915290205460ff1661155b5761151981611575565b611524836020611591565b604051602001611535929190611ae7565b60408051601f198184030181529082905262461bcd60e51b82526104fe91600401611b68565b5050565b60008261156c85846117c1565b14949350505050565b606061158b6001600160a01b0383166014611591565b92915050565b606060006115a0836002611a76565b6115ab906002611a5e565b67ffffffffffffffff8111156115c3576115c3611b9b565b6040519080825280601f01601f1916602001820160405280156115ed576020820181803683370190505b5090507f30000000000000000000000000000000000000000000000000000000000000008160008151811061162457611624611bb1565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053507f78000000000000000000000000000000000000000000000000000000000000008160018151811061168757611687611bb1565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060006116c3846002611a76565b6116ce906001611a5e565b90505b600181111561176b577f303132333435363738396162636465660000000000000000000000000000000085600f166010811061170f5761170f611bb1565b1a60f81b82828151811061172557611725611bb1565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060049490941c9361176481611bc7565b90506116d1565b5083156117ba5760405162461bcd60e51b815260206004820181905260248201527f537472696e67733a20686578206c656e67746820696e73756666696369656e7460448201526064016104fe565b9392505050565b600081815b8451811015611806576117f2828683815181106117e5576117e5611bb1565b602002602001015161180e565b9150806117fe81611bde565b9150506117c6565b509392505050565b600081831061182a5760008281526020849052604090206117ba565b60008381526020839052604090206117ba565b60006020828403121561184f57600080fd5b5035919050565b80356001600160a01b038116811461186d57600080fd5b919050565b6000806040838503121561188557600080fd5b61188e83611856565b915061189c60208401611856565b90509250929050565b600080604083850312156118b857600080fd5b8235915061189c60208401611856565b60008083601f8401126118da57600080fd5b50813567ffffffffffffffff8111156118f257600080fd5b6020830191508360208260051b850101111561190d57600080fd5b9250929050565b60008060008060008060a0878903121561192d57600080fd5b61193687611856565b9550602087013594506040870135935060608701359250608087013567ffffffffffffffff81111561196757600080fd5b61197389828a016118c8565b979a9699509497509295939492505050565b60008060008060006080868803121561199d57600080fd5b853594506020860135935060408601359250606086013567ffffffffffffffff8111156119c957600080fd5b6119d5888289016118c8565b969995985093965092949392505050565b6000806000806000608086880312156119fe57600080fd5b85359450611a0e60208701611856565b935060408601359250606086013567ffffffffffffffff8111156119c957600080fd5b634e487b7160e01b600052601160045260246000fd5b600082821015611a5957611a59611a31565b500390565b60008219821115611a7157611a71611a31565b500190565b6000816000190483118215151615611a9057611a90611a31565b500290565b600060208284031215611aa757600080fd5b815180151581146117ba57600080fd5b60005b83811015611ad2578181015183820152602001611aba565b83811115611ae1576000848401525b50505050565b7f416363657373436f6e74726f6c3a206163636f756e7420000000000000000000815260008351611b1f816017850160208801611ab7565b7f206973206d697373696e6720726f6c65200000000000000000000000000000006017918401918201528351611b5c816028840160208801611ab7565b01602801949350505050565b6020815260008251806020840152611b87816040850160208701611ab7565b601f01601f19169190910160400192915050565b634e487b7160e01b600052604160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b600081611bd657611bd6611a31565b506000190190565b600060018201611bf057611bf0611a31565b506001019056fea264697066735822122042274050735f9c21d3ae4bb3ff67199f77d98ed3e89a8f728d38d9dd41db247364736f6c634300080f0033",
      "linkReferences": {},
      "deployedLinkReferences": {}
    },
    "sourceCode": "// SPDX-License-Identifier: MIT\n\npragma solidity 0.8.15;\n\nimport \"@flair-sdk/contracts/access/ownable/OwnableInternal.sol\";\nimport \"@flair-sdk/contracts/finance/sales/TieredSales.sol\";\nimport \"@flair-sdk/contracts/finance/sales/ITieredSalesRoleBased.sol\";\nimport \"@flair-sdk/contracts/metatx/ERC2771ContextInternal.sol\";\nimport \"@flair-sdk/contracts/access/roles/AccessControlInternal.sol\";\nimport \"@flair-sdk/contracts/token/ERC721/facets/minting/IERC721MintableRoleBased.sol\";\nimport \"@flair-sdk/contracts/token/ERC1155/facets/minting/IERC1155MintableRoleBased.sol\";\nimport \"@flair-sdk/contracts/token/ERC1155/facets/sales/ERC1155TieredSalesStorage.sol\";\nimport \"@openzeppelin/contracts/security/ReentrancyGuard.sol\"; // TODO replace with diamond version\n\n/**\n * @title My Custom Tiered Sales\n * @notice This is developed in-house to provide custom sales mechanism for our custom project.\n *\n * @custom:type eip-2535-facet\n * @custom:category NFTs\n * @custom:provides-interfaces ITieredSales, ITieredSalesRoleBased\n */\ncontract MyCustomTieredSales is\n    ITieredSalesRoleBased,\n    OwnableInternal,\n    TieredSales,\n    ERC2771ContextInternal,\n    AccessControlInternal,\n    ReentrancyGuard\n{\n    using TieredSalesStorage for TieredSalesStorage.Layout;\n    using ERC1155TieredSalesStorage for ERC1155TieredSalesStorage.Layout;\n\n    bytes32 public constant MERCHANT_ROLE = keccak256(\"MERCHANT_ROLE\");\n    bytes32 internal constant STORAGE_SLOT = keccak256(\"v1.my-amazing-team.contracts.storage.MyCustomTieredSales\");\n\n    function _msgSender() internal view virtual override(Context, ERC2771ContextInternal) returns (address) {\n        return ERC2771ContextInternal._msgSender();\n    }\n\n    function _msgData() internal view virtual override(Context, ERC2771ContextInternal) returns (bytes calldata) {\n        return ERC2771ContextInternal._msgData();\n    }\n\n    function layout() internal pure returns (Layout storage l) {\n        bytes32 slot = STORAGE_SLOT;\n        assembly {\n            l.slot := slot\n        }\n    }\n\n    /**\n     * (1) Define state variables\n     *\n     * We must put all contract \"state\" variables in the Layout struct.\n     * This storage pattern enables modularization using the EIP-2325 Diamond Standard.\n     *\n     *  To learn more about this pattern, see the following resources:\n     *  - https://eips.ethereum.org/EIPS/eip-2325\n     *  - https://eip2535diamonds.substack.com\n     */\n    struct Layout {\n        address targetERC721ContractAddress;\n        address targetERC1155ContractAddress;\n    }\n\n    /**\n     * (2) Define custom functions\n     *\n     * You can put privileged functions (using Ownable or role-based AccessControl) here.\n     */\n    function setTargetTokens(address erc721ContractAddress, address erc1155ContractAddress) external onlyOwner {\n        layout().targetERC721ContractAddress = erc721ContractAddress;\n        layout().targetERC1155ContractAddress = erc1155ContractAddress;\n    }\n\n    /**\n     * (3) Customize the \"mintByTier\" method.\n     *\n     * This custom facet contract extends TieredSales, which needs us to define what sales logic we want\n     * when users are minting a specific tier.\n     */\n    function mintByTier(\n        uint256 tierId,\n        uint256 count,\n        uint256 maxAllowance,\n        bytes32[] calldata proof\n    ) external payable override nonReentrant {\n        // This call checks if user has enough allowance for the tier, checks the proof, records the minted amount,\n        // and ensures the payment is correct.\n        //\n        // If this call is not reverted you can safely provide the _msgSender() with any assets you want for the sale.\n        // For example you can mint \"count\" NFTs to the _msgSender(), or send \"count\" amount of an ERC20 tokens, etc.\n        super._executeSale(tierId, count, maxAllowance, proof);\n\n        // This is the custom logic for our project, which in this case is to mint from ERC721 and ERC1155 contracts.\n        IERC721MintableRoleBased(layout().targetERC721ContractAddress).mintByRole(_msgSender(), count);\n        IERC1155MintableRoleBased(layout().targetERC1155ContractAddress).mintByRole(\n            _msgSender(),\n            ERC1155TieredSalesStorage.layout().tierToTokenId[tierId],\n            count,\n            \"\"\n        );\n    }\n\n    /**\n     * (4) Customize the \"mintByTierByRole\" method.\n     *\n     * This function mints tokens based on tier and role. We need this function when minting an NFT\n     * with credit card or crypto payment.\n     */\n    function mintByTierByRole(\n        address minter,\n        uint256 tierId,\n        uint256 count,\n        uint256 maxAllowance,\n        bytes32[] calldata proof\n    ) external payable virtual nonReentrant onlyRole(MERCHANT_ROLE) {\n        super._executeSalePrivileged(minter, tierId, count, maxAllowance, proof);\n\n        IERC721MintableRoleBased(layout().targetERC721ContractAddress).mintByRole(_msgSender(), count);\n        IERC1155MintableRoleBased(layout().targetERC1155ContractAddress).mintByRole(\n            _msgSender(),\n            ERC1155TieredSalesStorage.layout().tierToTokenId[tierId],\n            count,\n            \"\"\n        );\n    }\n}\n"
  }
}
